containers:
  storyshots:
    image: eichelkrautadam/storyshots:0.3.1
    volumes:
      - local: <{batect.project_directory}/${STORYSHOTS_RESULTS_DIR:-storyshots}
        container: /storyshots/storyshots
      - local: <{batect.project_directory}/${STORYSHOTS_RESULTS_DIR:-storyshots}/test-results
        container: /storyshots/test-results
    run_as_current_user:
      enabled: true
      home_directory: /storyshots

  storybook-server:
    image: nginx:alpine
    volumes:
      - local: <{batect.project_directory}/${STORYBOOK_STATIC_DIR:-storybook-static}
        container: /usr/share/nginx/html
    ports:
      - local: 6006
        container: 80

tasks:
  storyshots:
    dependencies:
      - storybook-server
    run:
      container: storyshots

  storyshots-update:
    dependencies:
      - storybook-server
    run:
      container: storyshots
      command: npx playwright test --config=/storyshots/playwright.config.storyshots.ts --update-snapshots